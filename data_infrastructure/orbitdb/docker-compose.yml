services:
  orbitdb:
    build: .
    container_name: orbitdb-node
    env_file:
      - .env
    volumes:
      - orbitdb_data:/data/orbitdb
    ports:
      # Helia swarm ports (must not collide with your Kubo 4001)
      - "${HELIA_TCP_PORT}:${HELIA_TCP_PORT}"
      - "${HELIA_WS_PORT}:${HELIA_WS_PORT}"
      # HTTP gateway for your Express external adapter
      - "${ORBIT_HTTP_PORT}:${ORBIT_HTTP_PORT}"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:${ORBIT_HTTP_PORT}/health"]
      interval: 30s
      timeout: 5s
      retries: 3

volumes:
  orbitdb_data:
